
-------------------------------------------   Functions  ----------------------------------------------- </br>
// Function Declaration</br>
function twice(x) {</br>
    return x * 2;</br>
}</br>

// Function Expression</br>
const thrice = function(x) { return x * 3; };</br>

// Arrow Function Expression</br>
const fourTimes = (x) => x * 4;</br>

// Save a function in a variable</br>
const anotherNameForTwice = twice;</br>

console.log(twice(10));</br>
console.log(thrice(10));</br>
console.log(fourTimes(10));</br>
console.log(anotherNameForTwice(10));</br>

// Take function as argument</br>
function applyTwice(f, arg) {</br>
    return f(f(arg));</br>
}</br>

// What do we get here?</br>
console.log(applyTwice(twice, 10));</br>


------------------------------------ Function in array -----------------------------------------</br>
// Define an array</br>
const nthice = [];</br>
for (let i=0; i < 10; i++) {</br>
    // Fill the array with "functions"</br>
    nthice[i] = (x) => x * i;</br>
}</br>

// prints 6 - not a big surprise</br>
console.log(nthice[2](3));</br>


------------------------------------ Function in object -----------------------------------------</br>
const p1 = {</br>
    name: 'John',</br>
    hello: function() {</br>
        console.log('Hi!');</br>
    },</br>
}</br>
p1.hello();</br>

---- Same as:</br>
const p1 = {</br>
    name: 'John',</br>
    hello() {</br>
        console.log('Hi!');</br>
    },</br>
}</br>

p1.hello();

---- Add `this`:

const p1 = {</br>
    name: 'John',</br>
    hello() {</br>
        console.log(`Hi! ${this.name}`);</br>
    },</br>
}</br>

p1.hello();

----------------------   Use a function as an Object ------------------

function square(x) {
    return x * x;
}

// prints 1 - function expects 1 argument
console.log(square.length);

// prints "square" - as this is the name of the function</br>
console.log(square.name)

square.author = 'Ynon';</br>
console.log(square.author);


------------------------  פיתוח קוד מונחה עצמים  -----------------------

---------- Object of game --------</br>
const game = {</br>
    secret: 0,</br>
    numberOfTries: 10,</br>

    startNewGame() {
        this.secret= Math.floor(Math.random() * 10);
        this.numberOfTries = 0;
    },

    play(guess) {
        if (this.numberOfTries >= 10) {
            // Sorry, game over
            return;
        }
        this.numberOfTries += 1;
        if (guess > this.secret) {
            return 1;
        } else if (guess < this.secret) {
            return -1;
        } else {
            return 0;
        }
    }
}

---------- Object of game inside a function and return game object--------

function Game () {</br>
      const game = {</br>
      secret: 0,</br>
      numberOfTries: 10,</br>

      startNewGame() {
          this.secret= Math.floor(Math.random() * 10);
          this.numberOfTries = 0;
      },

      play(guess) {
          if (this.numberOfTries >= 10) {
              // Sorry, game over
              return;
          }
          this.numberOfTries += 1;
          if (guess > this.secret) {
              return 1;
          } else if (guess < this.secret) {
              return -1;
          } else {
              return 0;
          }
      }
    }
  return game;
}</br>

const game1 = Game();</br>
const game2 = Game();</br>
const game3 = Game();</br>


----------------------------------- Class with prototype ----------------------------
</br>
function Person(name) {</br>
    const person = {</br>
        name: name,</br>
        hello() {</br>
            console.log(`Hi! ${this.name}`);</br>
        },</br>
    }</br>
    return person;</br>
}</br>

const p1 = Person('one');</br>
const p2 = Person('two');</br>
</br>
p1.hello();</br>
p2.hello();</br>
</br>
>> p1.hello === p2.hello</br>
false!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</br>
</br>
To use a prototype you need:</br>
1. Call the constructor function with a "new" -> new Game()
2. Inside the function, use "this" to refer to your new object
3. Create a .prototype field on the function
Game.prototype = {}
 

1.) Prototype
2.) New
3.) This
</br>
function Person(name) {</br>
    this.name = name;</br>
}</br>
</br>
Person.prototype.hello = function() {</br>
    console.log(`Hi! ${this.name}`);</br>
}</br>
</br>
const p1 = new Person('one');</br>
const p2 = new Person('two');</br>

>> p1.hello === p2.hello
true!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

>> p2.hello === Person.prototype.hello
true!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!


----------------------------------- Class with `class` ----------------------------</br>
class Person {</br>
    constructor(name) {</br>
        this.name = name;</br>
    }</br>

    hello() {
        console.log(`Hi! ${this.name}`);
    }
}

const p1 = new Person('one');</br>
const p2 = new Person('two');</br>

>> typeof Person</br>
"function"

>> Person.prototype.hello === p1.hello</br>
true


--------------------------------------------  This ------------------------------------------</br>
class Counter {</br>
    constructor() {</br>
        this.val = 0;</br>
    }</br>
</br>
    inc() {
        this.val++;
        console.log(this.val);
    }
}

const c = new Counter();</br>
const btn = document.querySelector('button');</br>
btn.addEventListener('click', c.inc);</br>

// prints 1
c.inc();

// prints 2
c.inc();

But in button click -> NaN Why?

בקוד שלנו זה לא אנחנו שהפעלנו את הפונקציה אלא הדפדפן.</br>
:אנחנו רק העברנו את הפונקציה לכפתור וביקשנו מהדפדפן לקרוא לה כשלוחצים על הכפתור </br>
btn.addEventListener('click', c.inc);</br>

הדפדפן קיבל את הפונקציה אבל בלי האוביקט אליו היא היתה מחוברת</br>
את האוביקט this ולכן כשהפונקציה מופעלת באופן אוטומטי בעקבות לחיצה על הכפתור היא לא מקבלת דרך המשתנה </br>

--------------------------- פתרון 1 --------------------------</br>
class Counter {</br>
    constructor() {</br>
        this.val = 0;</br>
    }</br>
</br>
    inc() {
        this.val++;
        log.innerHTML = this.val;
    }
}

const c = new Counter();

const btn = document.querySelector('button');</br>
btn.addEventListener('click', function() {</br>
    c.inc();</br>
});</br>
</br>
--------------------------- bind -  פתרון 2 --------------------------</br>
class Counter {</br>
    constructor() {</br>
        this.val = 0;</br>
        this.inc = this.inc.bind(this);</br>
    }</br>
</br>
    inc() {
        this.val++;
        log.innerHTML = this.val;
    }
}</br>
const c = new Counter();</br>
const btn = document.querySelector('button');</br>
btn.addEventListener('click', c.inc);</br>

הקוד עובד אבל שימו לב להתפתחות מעניינת בעלילה</br>
אם קודם כל האוביקטים חלקו את כל הפונקציות</br>
עכשיו אנחנו יוצרים פונקציה חדשה בבנאי ולכן הפונקציה</br>
:inc עצמה לא תהיה משותפת לכל האוביקטים של המחלקה</br>

>> const x = new Counter();
>> const y = new Counter();
>> x.inc === y.inc;
false

--------------------------- פתרון 3 פונקצית חץ --------------------------</br>

class Counter {</br>
    constructor() {</br>
        this.val = 0;</br>
    }</br>
</br>
    inc = () => {
        this.val++;
        log.innerHTML = this.val;
    }
}
</br>
const c = new Counter();</br>
const btn = document.querySelector('button');</br>
btn.addEventListener('click', c.inc);</br>


--------------------------------------- Components ---------------------------------------------</br>
קומפוננטה בעולם פיתוח ווב תהיה מחלקה שמטפלת באזור מסוים במסך, </br>
.ויכולה להיות בקשר עם קומפוננטות אחרות או עם מידע אחר של היישום.</br>
הקומפוננטה אחראית על האזור שלה במסך</br>
.של אזור זה ועדכונו HTML כולל הרבה פעמים בניה של ה</br>

עליו היא צריכה לפעול  HTML קומפוננטה נכתבת בתור מחלקה שתקבל בבנאי אלמנט</br>
 DOM הקומפוננטה תיצור את האלמנטים ב</br>
 .תחבר אליהם קוד טיפול באירועים וכמובן תכתוב פלט לאותם אלמנטים</br>
</br>
Example:
< !DOCTYPE html>
< html>
    < head>
        < meta charset="UTF8" />
    < /head>
    < body>
        < div id="c1"></div>
        < div id="c2"></div>
        < script src="counter.js"></script>
    < /body>
< /html>
</br>
class Counter {</br>
    constructor(el) {</br>
        this.val = 0;</br>
        this.render(el);</br>
</br>
        this.inc = this.inc.bind(this);</br>
        this.incButton.addEventListener('click', this.inc);</br>
    }</br>

    render(el) {
        el.innerHTML = `
            <p>
                <button class="inc">Click Me</button>
                Clicks: <span class="log">${this.val}</span>
            </p>
        `;
        this.el = el;
        this.incButton = el.querySelector('.inc');
        this.log = el.querySelector('.log');
    }

    inc() {
        this.val++;
        this.log.textContent = this.val;
    }
}

const c1 = new Counter(document.querySelector('#c1'));</br>
const c2 = new Counter(document.querySelector('#c2'));</br>

const el = document.createElement('div');</br>
document.body.appendChild(el);</br>
const c3 = new Counter(el);</br>


------------------------------------------- מנהל אירועים --------------------------------------------</br>
this.unsubscribe = bus.subscribe('boom', this.handleBoomEvent.bind(this));</br>

// then later in the code, to stop listening we'll just call unsubscribe
this.unsubscribe();</br>

const even = [10, 12, 13, 15, 17, 20].filter(x => x % 2 === 0);</br>
const notTen = [10, 12, 13, 15, 17, 20].filter(x => x !== 10);</br>

class EventBus {</br>
  constructor() {</br>
    this.listeners = {};</br>
  }</br>
</br>
  subscribe(eventName, handler) {
    if (!this.listeners[eventName]) {
      this.listeners[eventName] = [];
    }

    this.listeners[eventName].push(handler);
    return () => {
      this.listeners[eventName] = this.listeners[eventName].filter(fn => fn !== handler);
    }
  }
}

 emit(eventName, ...args) {</br>
    const listeners = this.listeners[eventName] || [];</br>
    for (let fn of listeners) {</br>
      fn(...args);</br>
    }</br>
  }</br>

  bus.emit('boom', 10, 20);</br>
  
const t = bus.subscribe('boom', function(x) { console.log('Boom!', x)});</br>
const u = bus.subscribe('boom', function(x) { console.log('Boom!', x * x )});</br>
bus.emit('boom', 10)</br>
// Prints: Boom! 10 
// And then prints: Boom! 100

u()</br>
bus.emit('boom', 10)</br>
// Prints: Boom! 10


----------------------------  חיבור מנהל האירועים לקומפוננטות -------------------------</br>
</br>
class EventBus {</br>
  constructor() {</br>
    this.listeners = {};</br>
  }</br>
</br>
  subscribe(eventName, handler) {
    if (!this.listeners[eventName]) {
      this.listeners[eventName] = [];
    }

    this.listeners[eventName].push(handler);
    return () => {
      this.listeners[eventName] = this.listeners[eventName].filter(fn => fn !== handler);
    }
  }

  emit(eventName, ...args) {
    const listeners = this.listeners[eventName] || [];
    for (let fn of listeners) {
      fn(...args);
    }
  }
}
</br>
class Display {</br>
  constructor(el, bus) {</br>
    this.setupUi(el);</br>
    this.eventBus = bus;</br>
    this.eventBus.subscribe('value', this.update.bind(this));</br>
  }</br>
</br>
  setupUi(el) {
    el.innerHTML = `
            <p>And the maximum value is: <span class="maxvalue"></span></p>
        `;
    this.panel = el.querySelector('.maxvalue');
  }

  update(val) {
    if (val > Number(this.panel.textContent)) {
      this.panel.textContent = val;
    }
  }
}

class Counter {</br>
  constructor(el, bus) {</br>
    this.val = 0;</br>
    this.setupUi(el);</br>
    this.eventBus = bus;</br>
  }</br>
</br>
  setupUi(el) {
    el.innerHTML = `
            <p>
            <button>Click To Inc</button>
            <span class="log"></span>
            </p>
        `;</br>
    this.log = el.querySelector('.log');</br>
    this.button = el.querySelector('button');</br>
    this.button.addEventListener('click', this.inc.bind(this));</br>
    this.updateUi();</br>
  }</br>

  inc = () => {
    this.val++;
    this.eventBus.emit('value', this.val);
    this.updateUi();
  }

  updateUi() {
    this.log.innerHTML = this.val;
  }
}

const bus = new EventBus();</br>

const panelElement = document.createElement('div');</br>
const panel = new Display(panelElement, bus);</br>
document.body.appendChild(panelElement);</br>
</br>
for (let i=0; i < 5; i++) {</br>
  const el = document.createElement('div');</br>
  const counter = new Counter(el, bus);</br>
  document.body.appendChild(el);</br>
}

